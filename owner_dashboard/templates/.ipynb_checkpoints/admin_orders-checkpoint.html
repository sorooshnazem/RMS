<!DOCTYPE html>
<html>
<head>
    <title>Live Orders Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ccc;
            text-align: left;
        }
        tr:hover {
            background-color: #f5f5f5;
            cursor: pointer;
        }
        #order-detail {
            max-width: 800px;
            margin: 20px auto;
            border: 1px solid #ccc;
            padding: 15px;
            display: none;
        }
    </style>
</head>
<body>

    <h1>Live Incoming Orders</h1>

    <table id="orders-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Customer</th>
                <th>Phone</th>
                <th>Time</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Orders will be inserted here -->
        </tbody>
    </table>

    <div id="order-detail">
        <h2>Order Details</h2>
        <div id="detail-content">Select an order to view details.</div>
    </div>

    <script>
        async function fetchOrders() {
            const res = await fetch('/api/orders');
            const orders = await res.json();

            const tbody = document.querySelector('#orders-table tbody');
            tbody.innerHTML = '';

            orders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id_order_id}</td>
                    <td>${order.gn_full_name}</td>
                    <td>${order.nm_phone_number}</td>
                    <td>${order.dt_order_date}</td>
                    <td>${order.gn_order_status_name}</td>
                `;
                row.onclick = () => showOrderDetail(order.id_order_id);
                tbody.appendChild(row);
            });
        }

        async function showOrderDetail(orderId) {
            const res = await fetch(`/api/orders/${orderId}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById('detail-content').innerText = data.error;
            } else {
                const itemsHtml = data.items.map(item => `
                    <li>${item.gn_food_name} – ${item.nm_quantity_number} × €${item.nm_price_number}</li>
                `).join('');
                document.getElementById('detail-content').innerHTML = `
                    <p><strong>Name:</strong> ${data.order.gn_full_name}</p>
                    <p><strong>Phone:</strong> ${data.order.nm_phone_number}</p>
                    <p><strong>Date:</strong> ${data.order.dt_order_datetime}</p>
                    <p><strong>Items:</strong></p>
                    <ul>${itemsHtml}</ul>
                `;
                document.getElementById('order-detail').style.display = 'block';
            }
        }

        // Initial fetch and refresh every 10 seconds
        fetchOrders();
        setInterval(fetchOrders, 10000);
    </script>

</body>
</html>


